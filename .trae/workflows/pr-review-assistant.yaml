name: PR Review åŠ©æ‰‹
version: "2.0.0"
description: è‡ªåŠ¨åˆ†æPRå˜æ›´ï¼Œç”ŸæˆReviewå»ºè®®ï¼Œæ£€æŸ¥ä»£ç è´¨é‡
source: "æ”¹ç¼–è‡ªGitHub PR Reviewå·¥ä½œæµ"
category: "code-quality"
tags: ["pr", "review", "code-quality", "automation", "github"]
triggers:
  - "PR Review"
  - "ä»£ç å®¡æŸ¥"
  - "pr review"
  - "review PR"

steps:
  - id: 1
    name: åˆ›å»ºè¾“å‡ºç›®å½•
    action: run_command
    params:
      command: "python -c \"import os; os.makedirs('output', exist_ok=True)\""
      timeout: 5

  - id: 2
    name: è·å–PRå˜æ›´æ–‡ä»¶
    action: run_command
    params:
      command: |
        echo "=== PRå˜æ›´æ–‡ä»¶ ===" &&
        git diff --name-only HEAD~1..HEAD 2>nul || echo "æ— Gitå˜æ›´" &&
        echo "" &&
        echo "å˜æ›´ç»Ÿè®¡:" &&
        git diff --stat HEAD~1..HEAD 2>nul || echo "æ— ç»Ÿè®¡"
      save_as: changed_files
      timeout: 15

  - id: 3
    name: åˆ†æä»£ç å˜æ›´
    action: run_command
    params:
      command: |
        echo "=== ä»£ç å˜æ›´åˆ†æ ===" &&
        echo "" &&
        echo "å˜æ›´ç±»å‹åˆ†å¸ƒ:" &&
        git diff --numstat HEAD~1..HEAD 2>nul | python -c "import sys; lines=[l.strip().split() for l in sys.stdin if l.strip()]; added=sum(int(l[0]) for l in lines if l[0].isdigit()); deleted=sum(int(l[1]) for l in lines if l[1].isdigit()); print(f'  æ–°å¢è¡Œæ•°: {added}'); print(f'  åˆ é™¤è¡Œæ•°: {deleted}'); print(f'  å‡€å˜åŒ–: {added-deleted:+d}')" || echo "æ— æ³•è®¡ç®—"
      save_as: change_analysis
      timeout: 15

  - id: 4
    name: æ£€æŸ¥ä»£ç é£æ ¼
    action: run_command
    params:
      command: |
        echo "=== ä»£ç é£æ ¼æ£€æŸ¥ ===" &&
        echo "" &&
        echo "Pythonæ–‡ä»¶æ£€æŸ¥:" &&
        python -m flake8 --version 2>nul && echo "flake8å¯ç”¨" || echo "flake8æœªå®‰è£…" &&
        echo "" &&
        echo "å»ºè®®æ£€æŸ¥é¡¹:" &&
        echo "  âœ“ å‘½åè§„èŒƒ" &&
        echo "  âœ“ ä»£ç æ ¼å¼" &&
        echo "  âœ“ å¯¼å…¥é¡ºåº" &&
        echo "  âœ“ æ–‡æ¡£å­—ç¬¦ä¸²"
      save_as: style_check
      timeout: 30

  - id: 5
    name: ç”ŸæˆReviewå»ºè®®
    action: run_command
      command: |
        echo "=== Reviewå»ºè®® ===" &&
        echo "" &&
        echo "ğŸ” éœ€è¦å…³æ³¨çš„é—®é¢˜:" &&
        echo "" &&
        echo "1. å®‰å…¨æ€§æ£€æŸ¥" &&
        echo "   - æ£€æŸ¥æ˜¯å¦æœ‰ç¡¬ç¼–ç å¯†é’¥" &&
        echo "   - æ£€æŸ¥SQLæ³¨å…¥é£é™©" &&
        echo "   - æ£€æŸ¥XSSé£é™©" &&
        echo "" &&
        echo "2. æ€§èƒ½è€ƒè™‘" &&
        echo "   - æ£€æŸ¥å¾ªç¯ä¸­çš„æ•°æ®åº“æŸ¥è¯¢" &&
        echo "   - æ£€æŸ¥å†…å­˜ä½¿ç”¨" &&
        echo "" &&
        echo "3. ä»£ç è´¨é‡" &&
        echo "   - æ£€æŸ¥é”™è¯¯å¤„ç†" &&
        echo "   - æ£€æŸ¥è¾¹ç•Œæ¡ä»¶" &&
        echo "   - æ£€æŸ¥æµ‹è¯•è¦†ç›–"
      save_as: review_suggestions
      timeout: 10

  - id: 6
    name: ç”ŸæˆReviewæŠ¥å‘Š
    action: generate_document
    params:
      output: "output/pr-review-report-{{current_date}}.md"
      content: |
        # PR Review æŠ¥å‘Š
        
        **ç”Ÿæˆæ—¶é—´**: {{current_date}} {{current_time}}
        
        ## å˜æ›´æ–‡ä»¶
        
        {{changed_files}}
        
        ## å˜æ›´åˆ†æ
        
        {{change_analysis}}
        
        ## ä»£ç é£æ ¼
        
        {{style_check}}
        
        ## Reviewå»ºè®®
        
        {{review_suggestions}}
        
        ## æ£€æŸ¥æ¸…å•
        
        - [ ] ä»£ç é€»è¾‘æ­£ç¡®
        - [ ] æ— å®‰å…¨æ¼æ´
        - [ ] æœ‰è¶³å¤Ÿçš„æµ‹è¯•
        - [ ] æ–‡æ¡£å·²æ›´æ–°
        - [ ] æ— æ€§èƒ½é—®é¢˜

  - id: 7
    name: éªŒè¯æŠ¥å‘Šç”Ÿæˆ
    action: verify
    type: file_exists
    path: "output/pr-review-report-{{current_date}}.md"
    fail_message: "ReviewæŠ¥å‘Šæœªç”Ÿæˆ"

  - id: 8
    name: è¾“å‡ºReviewç»“æœ
    action: notify
    params:
      message: |
        âœ… PR Review åˆ†æå®Œæˆï¼
        
        å˜æ›´æ–‡ä»¶:
        {{changed_files}}
        
        å˜æ›´åˆ†æ:
        {{change_analysis}}
        
        Reviewå»ºè®®:
        {{review_suggestions}}
        
        æŠ¥å‘Š: output/pr-review-report-{{current_date}}.md