name: å˜æ›´æ—¥å¿—ç”Ÿæˆå™¨
version: "1.0.0"
description: åŸºäºgitæäº¤è®°å½•è‡ªåŠ¨ç”ŸæˆCHANGELOG.md
created_at: "2026-02-11"
category: documentation
tags: ["changelog", "git", "release", "documentation", "history"]
triggers:
  - "ç”Ÿæˆchangelog"
  - "æ›´æ–°å˜æ›´æ—¥å¿—"
  - "ç”Ÿæˆå‘å¸ƒè¯´æ˜"
  - "changelog"
steps:
  - id: 1
    name: è·å–gitæ ‡ç­¾åˆ—è¡¨
    action: run_command
    params:
      command: "git tag --sort=-version:refname | head -10"
      save_as: git_tags
      timeout: 10

  - id: 2
    name: è·å–æœ€è¿‘çš„æäº¤å†å²
    action: run_command
    params:
      command: "git log --pretty=format:'%h|%s|%an|%ad' --date=short -50"
      save_as: commit_history
      timeout: 10

  - id: 3
    name: åˆ†ææäº¤ç±»å‹
    action: run_command
    params:
      command: |
        echo "=== æäº¤ç±»å‹åˆ†æ ===" &&
        echo "åŠŸèƒ½æ·»åŠ :" && git log --oneline --grep="^feat" -20 2>nul | wc -l &&
        echo "ä¿®å¤:" && git log --oneline --grep="^fix" -20 2>nul | wc -l &&
        echo "æ–‡æ¡£:" && git log --oneline --grep="^docs" -20 2>nul | wc -l &&
        echo "é‡æ„:" && git log --oneline --grep="^refactor" -20 2>nul | wc -l &&
        echo "æµ‹è¯•:" && git log --oneline --grep="^test" -20 2>nul | wc -l &&
        echo "å…¶ä»–:" && git log --oneline --grep="^chore\|^style\|^perf" -20 2>nul | wc -l
      save_as: commit_types
      timeout: 15

  - id: 4
    name: æå–åŠŸèƒ½å˜æ›´
    action: run_command
    params:
      command: |
        echo "### âœ¨ æ–°åŠŸèƒ½" &&
        git log --pretty=format:'- %s (%h)' --grep="^feat" -20 2>nul &&
        echo "" &&
        echo "### ğŸ› ä¿®å¤" &&
        git log --pretty=format:'- %s (%h)' --grep="^fix" -20 2>nul
      save_as: feature_changes
      timeout: 10

  - id: 5
    name: ç”ŸæˆCHANGELOGå†…å®¹
    action: run_command
    params:
      command: |
        echo "# Changelog" > CHANGELOG.tmp &&
        echo "" >> CHANGELOG.tmp &&
        echo "æ‰€æœ‰é¡¹ç›®çš„æ˜¾è‘—å˜æ›´éƒ½å°†è®°å½•åœ¨æ­¤æ–‡ä»¶ä¸­ã€‚" >> CHANGELOG.tmp &&
        echo "" >> CHANGELOG.tmp &&
        echo "æ ¼å¼åŸºäº [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)ï¼Œ" >> CHANGELOG.tmp &&
        echo "å¹¶ä¸”è¯¥é¡¹ç›®éµå¾ª [è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/lang/zh-CN/)ã€‚" >> CHANGELOG.tmp &&
        echo "" >> CHANGELOG.tmp &&
        echo "## [Unreleased]" >> CHANGELOG.tmp &&
        echo "" >> CHANGELOG.tmp &&
        echo "{{feature_changes}}" >> CHANGELOG.tmp &&
        echo "" >> CHANGELOG.tmp &&
        echo "### ğŸ“š æ–‡æ¡£" >> CHANGELOG.tmp &&
        git log --pretty=format:'- %s (%h)' --grep="^docs" -10 2>nul >> CHANGELOG.tmp &&
        echo "" >> CHANGELOG.tmp &&
        echo "### ğŸ”§ å…¶ä»–å˜æ›´" >> CHANGELOG.tmp &&
        git log --pretty=format:'- %s (%h)' --grep="^chore\|^refactor\|^style\|^perf" -10 2>nul >> CHANGELOG.tmp &&
        type CHANGELOG.tmp
      save_as: changelog_content
      timeout: 15

  - id: 6
    name: å†™å…¥CHANGELOGæ–‡ä»¶
    action: run_command
    params:
      command: |
        type CHANGELOG.tmp > CHANGELOG.md &&
        del CHANGELOG.tmp &&
        echo "CHANGELOG.md å·²æ›´æ–°" &&
        type CHANGELOG.md | head -50
      save_as: write_result
      timeout: 10

  - id: 7
    name: ç”Ÿæˆå‘å¸ƒè¯´æ˜è‰ç¨¿
    action: generate_document
    params:
      template: "release-notes.md"
      variables:
        version: "{{git_tags}}"
        changes: "{{feature_changes}}"
        commit_types: "{{commit_types}}"
        date: "{{current_date}}"
      output: "docs/release-notes-draft-{{current_date}}.md"
      save_as: release_notes

  - id: 8
    name: è¾“å‡ºç”Ÿæˆç»“æœ
    action: notify
    params:
      message: |
        å˜æ›´æ—¥å¿—ç”Ÿæˆå®Œæˆï¼
        
        æœ€è¿‘çš„æ ‡ç­¾:
        {{git_tags}}
        
        æäº¤ç±»å‹ç»Ÿè®¡:
        {{commit_types}}
        
        ä¸»è¦å˜æ›´:
        {{feature_changes}}
        
        æ–‡ä»¶å·²æ›´æ–°:
        - CHANGELOG.md
        - {{release_notes}}