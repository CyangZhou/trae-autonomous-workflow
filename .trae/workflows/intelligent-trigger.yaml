name: æ™ºèƒ½å·¥ä½œæµè§¦å‘å™¨
version: "3.0.0"
description: æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æ„ŸçŸ¥å¹¶æ¨èå·¥ä½œæµï¼Œæ”¯æŒèœ‚ç¾¤æ¨¡å¼å¹¶è¡Œæ‰§è¡Œå¤æ‚ä»»åŠ¡
category: "automation"
tags: ["intelligent", "proactive", "auto-trigger", "context-aware", "swarm"]

intelligence:
  context_rules:
    - name: "ä¾èµ–æ›´æ–°æ£€æµ‹"
      patterns: ["requirements.txt", "package.json", "Cargo.toml", "go.mod"]
      action: "suggest_workflow"
      workflow: "dependency-auto-update"
      message: "æ£€æµ‹åˆ°ä¾èµ–æ–‡ä»¶å˜æ›´ï¼Œå»ºè®®æ£€æŸ¥ä¾èµ–æ›´æ–°å’Œå®‰å…¨æ¼æ´"
      auto_run: false
      priority: high
    
    - name: "APIæ–‡æ¡£åŒæ­¥æ£€æŸ¥"
      patterns: ["*api*.py", "*route*.py", "*endpoint*.py"]
      file_content: ["@app.route", "def api_", "@router"]
      action: "suggest_workflow"
      workflow: "doc-sync-check"
      message: "æ£€æµ‹åˆ°APIä»£ç å˜æ›´ï¼Œå»ºè®®æ£€æŸ¥æ–‡æ¡£åŒæ­¥"
      auto_run: false
      priority: medium
    
    - name: "è¦†ç›–ç‡æ£€æŸ¥"
      patterns: ["*test*.py", "test_*.py", "*_test.py"]
      action: "suggest_workflow"
      workflow: "code-coverage-report"
      message: "æ£€æµ‹åˆ°æµ‹è¯•ä»£ç å˜æ›´ï¼Œå»ºè®®è¿è¡Œè¦†ç›–ç‡æ£€æŸ¥"
      auto_run: false
      priority: medium
    
    - name: "æäº¤å‰æ£€æŸ¥"
      git_hook: "pre-commit"
      action: "run_workflows"
      workflows: ["security-scan-local", "code-review"]
      message: "æäº¤å‰è‡ªåŠ¨è¿è¡Œå®‰å…¨å’Œä»£ç æ£€æŸ¥"
      auto_run: true
      priority: high
    
    - name: "PRè‡ªåŠ¨åŒ–"
      git_hook: "pr-created"
      action: "run_workflows"
      workflows: ["pr-size-labeler", "code-coverage-report", "doc-sync-check"]
      message: "PRåˆ›å»ºæ—¶è‡ªåŠ¨è¿è¡Œæ£€æŸ¥"
      auto_run: true
      priority: high
    
    - name: "å¤æ‚ä»»åŠ¡æ£€æµ‹"
      patterns: ["*æ¶æ„*.md", "*è®¾è®¡*.md", "ARCHITECTURE.md"]
      keywords: ["é‡æ„", "æ¶æ„", "ç³»ç»Ÿè®¾è®¡", "æ–°åŠŸèƒ½å¼€å‘"]
      action: "suggest_swarm"
      message: "æ£€æµ‹åˆ°å¤æ‚ä»»åŠ¡ï¼Œå»ºè®®å¯åŠ¨èœ‚ç¾¤æ¨¡å¼å¹¶è¡Œæ‰§è¡Œ"
      auto_run: false
      priority: high
      swarm_config:
        orchestrator: "swarm-orchestrator"
        workers: ["researcher", "coder", "tester", "writer"]
    
    - name: "æ‰¹é‡æ–‡ä»¶å˜æ›´"
      condition: "changed_files_count > 5"
      action: "suggest_swarm"
      message: "æ£€æµ‹åˆ°æ‰¹é‡æ–‡ä»¶å˜æ›´ï¼Œå»ºè®®å¯åŠ¨èœ‚ç¾¤æ¨¡å¼å¹¶è¡Œå¤„ç†"
      auto_run: false
      priority: medium
      swarm_config:
        orchestrator: "swarm-orchestrator"
        parallel_workers: 3

  ui:
    notification_type: "inline"
    show_in_panel: true
    one_click_execute: true
    dismiss_after: 3600

  learning:
    enabled: true
    track_user_choices: true
    user_preferences:
      auto_run_list: []
      ignore_list: []
      swarm_preferred: false

swarm_mode:
  enabled: true
  
  auto_trigger_conditions:
    - condition: "complexity == 'complex'"
      action: "suggest_swarm"
    - condition: "estimated_time > 5min"
      action: "suggest_swarm"
    - condition: "subtasks_count > 3"
      action: "auto_swarm"
  
  orchestrator:
    skill: "swarm-orchestrator"
    
  workers:
    researcher:
      capabilities: ["web_search", "doc_reading", "knowledge_extraction"]
      max_instances: 2
    coder:
      capabilities: ["code_writing", "refactoring", "bug_fixing"]
      max_instances: 3
    tester:
      capabilities: ["unit_test", "integration_test", "performance_test"]
      max_instances: 2
    writer:
      capabilities: ["documentation", "readme", "api_docs"]
      max_instances: 1
    reviewer:
      capabilities: ["code_review", "security_scan", "best_practices"]
      max_instances: 1

triggers:
  - "æ™ºèƒ½å·¥ä½œæµ"
  - "è‡ªåŠ¨è§¦å‘"
  - "intelligent workflow"
  - "å¸®æˆ‘çœ‹çœ‹"
  - "æ£€æŸ¥é¡¹ç›®"
  - "èœ‚ç¾¤æ¨¡å¼"
  - "å¹¶è¡Œæ‰§è¡Œ"
  - "/swarm"

steps:
  - id: 1
    name: æ‰«æé¡¹ç›®ä¸Šä¸‹æ–‡
    action: run_command
    params:
      command: |
        echo "=== æ™ºèƒ½ä¸Šä¸‹æ–‡æ‰«æ v3.0 ===" &&
        echo "" &&
        echo "æ­£åœ¨åˆ†æé¡¹ç›®çŠ¶æ€..." &&
        echo "" &&
        echo "ğŸ“ æ–‡ä»¶å˜æ›´æ£€æµ‹:" &&
        echo "  - æ£€æŸ¥ requirements.txt å˜æ›´..." &&
        echo "  - æ£€æŸ¥ API ä»£ç å˜æ›´..." &&
        echo "  - æ£€æŸ¥æµ‹è¯•æ–‡ä»¶å˜æ›´..." &&
        echo "" &&
        echo "ğŸ”„ GitçŠ¶æ€æ£€æµ‹:" &&
        echo "  - æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤å˜æ›´..." &&
        echo "  - æ£€æŸ¥å½“å‰åˆ†æ”¯..." &&
        echo "" &&
        echo "ğŸ“Š é¡¹ç›®å¥åº·åº¦:" &&
        echo "  - æ£€æŸ¥ Issue æ•°é‡..." &&
        echo "  - æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡..." &&
        echo "  - æ£€æŸ¥ä¾èµ–æ¼æ´..." &&
        echo "" &&
        echo "ğŸ èœ‚ç¾¤æ¨¡å¼æ£€æµ‹:" &&
        echo "  - åˆ†æä»»åŠ¡å¤æ‚åº¦..." &&
        echo "  - æ£€æµ‹æ˜¯å¦é€‚åˆå¹¶è¡Œæ‰§è¡Œ..."
      save_as: context_scan
      timeout: 15

  - id: 2
    name: åŒ¹é…å·¥ä½œæµ
    action: run_command
    params:
      command: |
        echo "=== æ™ºèƒ½å·¥ä½œæµæ¨è v3.0 ===" &&
        echo "" &&
        echo "åŸºäºé¡¹ç›®åˆ†æï¼Œæ¨èä»¥ä¸‹å·¥ä½œæµ:" &&
        echo "" &&
        echo "ğŸ”´ é«˜ä¼˜å…ˆçº§ (å»ºè®®ç«‹å³å¤„ç†):" &&
        echo "" &&
        echo "1. [security-scan-local] å®‰å…¨æ‰«æ" &&
        echo "   åŸå› : é¡¹ç›®åŒ…å«ä¾èµ–ï¼Œå»ºè®®å®šæœŸå®‰å…¨æ£€æŸ¥" &&
        echo "   æ“ä½œ: [ä¸€é”®è¿è¡Œ] [æŸ¥çœ‹è¯¦æƒ…] [å¿½ç•¥]" &&
        echo "" &&
        echo "2. [code-coverage-report] è¦†ç›–ç‡æŠ¥å‘Š" &&
        echo "   åŸå› : æ£€æµ‹åˆ°æµ‹è¯•æ–‡ä»¶ï¼Œä½†æœªç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š" &&
        echo "   æ“ä½œ: [ä¸€é”®è¿è¡Œ] [æŸ¥çœ‹è¯¦æƒ…] [å¿½ç•¥]" &&
        echo "" &&
        echo "ğŸ èœ‚ç¾¤æ¨¡å¼æ¨è:" &&
        echo "" &&
        echo "3. [swarm-execution] å¤æ‚ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ" &&
        echo "   åŸå› : æ£€æµ‹åˆ°å¤æ‚ä»»åŠ¡ï¼Œé€‚åˆå¹¶è¡Œå¤„ç†" &&
        echo "   æ“ä½œ: [å¯åŠ¨èœ‚ç¾¤] [æŸ¥çœ‹è¯¦æƒ…]" &&
        echo "" &&
        echo "ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ (å»ºè®®æœ¬å‘¨å¤„ç†):" &&
        echo "" &&
        echo "4. [doc-sync-check] æ–‡æ¡£åŒæ­¥æ£€æŸ¥" &&
        echo "   åŸå› : é¡¹ç›®æœ‰READMEï¼Œå»ºè®®æ£€æŸ¥æ–‡æ¡£å®Œæ•´æ€§" &&
        echo "   æ“ä½œ: [ä¸€é”®è¿è¡Œ] [æŸ¥çœ‹è¯¦æƒ…] [å¿½ç•¥]"
      save_as: workflow_recommendations
      timeout: 10

  - id: 3
    name: ç”Ÿæˆæ™ºèƒ½é…ç½®
    action: run_command
    params:
      command: |
        echo "# æ™ºèƒ½å·¥ä½œæµé…ç½®æ–‡ä»¶ v3.0" > .trae/intelligent-workflow.yaml &&
        echo "# æ­¤æ–‡ä»¶ç”±æ™ºèƒ½è§¦å‘å™¨è‡ªåŠ¨ç”Ÿæˆ" >> .trae/intelligent-workflow.yaml &&
        echo "# æ”¯æŒèœ‚ç¾¤æ¨¡å¼å¹¶è¡Œæ‰§è¡Œ" >> .trae/intelligent-workflow.yaml &&
        echo "" >> .trae/intelligent-workflow.yaml &&
        echo "version: \"3.0.0\"" >> .trae/intelligent-workflow.yaml &&
        echo "" >> .trae/intelligent-workflow.yaml &&
        echo "# è‡ªåŠ¨æ‰§è¡Œçš„å·¥ä½œæµ (æ— éœ€ç¡®è®¤)" >> .trae/intelligent-workflow.yaml &&
        echo "auto_run:" >> .trae/intelligent-workflow.yaml &&
        echo "  - security-scan-local" >> .trae/intelligent-workflow.yaml &&
        echo "  - code-review" >> .trae/intelligent-workflow.yaml &&
        echo "" >> .trae/intelligent-workflow.yaml &&
        echo "# èœ‚ç¾¤æ¨¡å¼é…ç½®" >> .trae/intelligent-workflow.yaml &&
        echo "swarm_mode:" >> .trae/intelligent-workflow.yaml &&
        echo "  enabled: true" >> .trae/intelligent-workflow.yaml &&
        echo "  auto_trigger: false" >> .trae/intelligent-workflow.yaml &&
        echo "  max_workers: 5" >> .trae/intelligent-workflow.yaml &&
        echo "" >> .trae/intelligent-workflow.yaml &&
        echo "# éœ€è¦ç¡®è®¤çš„å·¥ä½œæµ" >> .trae/intelligent-workflow.yaml &&
        echo "confirm_before_run:" >> .trae/intelligent-workflow.yaml &&
        echo "  - smart-release" >> .trae/intelligent-workflow.yaml &&
        echo "  - dependency-auto-update" >> .trae/intelligent-workflow.yaml &&
        echo "  - swarm-execution" >> .trae/intelligent-workflow.yaml &&
        type .trae/intelligent-workflow.yaml
      save_as: intelligent_config
      timeout: 10

  - id: 4
    name: è¾“å‡ºç”Ÿæˆç»“æœ
    action: notify
    params:
      message: |
        ğŸ‰ æ™ºèƒ½å·¥ä½œæµç³»ç»Ÿ v3.0 å·²é…ç½®å®Œæˆï¼
        
        {{context_scan}}
        
        {{workflow_recommendations}}
        
        ç”Ÿæˆçš„æ–‡ä»¶:
        - æ™ºèƒ½é…ç½®: .trae/intelligent-workflow.yaml
        
        ğŸ†• èœ‚ç¾¤æ¨¡å¼å·²é›†æˆ:
        - å¤æ‚ä»»åŠ¡è‡ªåŠ¨æ£€æµ‹
        - å¤š Worker å¹¶è¡Œæ‰§è¡Œ
        - DAG ä¾èµ–è°ƒåº¦
        
        ç°åœ¨ä½ å¯ä»¥ï¼š
        1. è¯´ "å¸®æˆ‘çœ‹çœ‹é¡¹ç›®" â†’ è‡ªåŠ¨åˆ†æå¹¶æ¨èå·¥ä½œæµ
        2. è¯´ "å¯åŠ¨èœ‚ç¾¤" â†’ å¹¶è¡Œæ‰§è¡Œå¤æ‚ä»»åŠ¡
        3. ä¿®æ”¹æ–‡ä»¶ â†’ è‡ªåŠ¨è§¦å‘ç›¸å…³æ£€æŸ¥
        4. ä¸€é”®æ‰§è¡Œæ¨èçš„å·¥ä½œæµ