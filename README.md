# Trae 自动化工作流系统 v9.1

> **一句话定义**：触发词 → 自主执行 → 闭环交付

[![GitHub Stars](https://img.shields.io/github/stars/CyangZhou/trae-autonomous-workflow?style=social)](https://github.com/CyangZhou/trae-autonomous-workflow)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

---

## 一、什么是自动化工作流？

### 1.1 核心概念

📌 **想象一个智能管家**

| 场景 | 传统方式 | 自动化工作流 |
|:---|:---|:---|
| 你说"帮我订机票" | 需要你一步步确认：去哪？什么时候？哪个航班？ | 自动理解意图，直接完成预订 |
| 你说"写个报告" | 需要多轮对话，逐步引导 | 一句话触发，全程自动执行 |
| 任务执行出错 | 可能中途停止，需要重新开始 | 自动反思修复，继续执行 |

💡 **核心价值**：
- 用户只需说一句话，Agent 自动完成从需求到交付的全流程
- 无需人工干预，自动规划、执行、验证、交付
- 错误自动修复，成功自动沉淀为可复用记忆

### 1.2 与普通对话的区别

| 对比维度 | 普通对话 | 自动化工作流 |
|:---|:---|:---|
| **交互方式** | 多轮交互，逐步引导 | 一句话触发，全程自动 |
| **确认机制** | 需要用户确认每一步 | 默认无需确认 |
| **执行保证** | 可能中途停止 | 必须完整执行 |
| **记忆沉淀** | 无记忆沉淀 | 自动归档成功/失败模式 |

### 1.3 执行本质

```
用户输入触发词 → Agent 立即调用 autonomous-agent 技能 →
自动解析任务 → 自动选择策略 → 自动执行 → 自动验证 → 自动交付
```

---

## 二、如何使用？

### 2.1 触发词

💡 **只需说出以下任意触发词，系统将自动启动：**

| 触发词 | 说明 |
|:---:|:---|
| **开始** | 最常用的启动词 |
| **继续** | 继续上次未完成的任务 |
| **自主执行** | 明确要求自动执行 |
| **自动执行** | 同上 |
| **蜂群** | 启动多智能体并行模式 |
| **autonomous** | 英文触发词 |

### 2.2 使用示例

**示例 1：简单任务（提示增强场景）**

```
用户：开始 帮我改个函数名
系统：[自动执行] 检测到简单任务，直接完成
```

**示例 2：中等任务（Skill复用场景）**

```
用户：开始 帮我写一篇公众号文章
系统：[自动发现] 找到 gzh-writer 技能
系统：[自动调用] 执行技能，生成文章
```

**示例 3：复杂任务（蜂群编排场景）**

```
用户：开始 从0搭建一个用户系统
系统：[自动分解] 拆分为前端、后端、数据库子任务
系统：[并行执行] 多个智能体同时工作
系统：[自动整合] 汇总结果，交付完整系统
```

### 2.3 CLI 命令参考

如果你更喜欢命令行操作，可以使用以下命令：

| 功能 | 命令 | 说明 |
|:---|:---|:---|
| **初始化** | `python ./.trae/skills/autonomous-agent/agent.py init` | 初始化内核 |
| **任务解析** | `python ./.trae/skills/autonomous-agent/agent.py analyze "任务"` | 生成执行计划 |
| **完整工作流** | `python ./.trae/skills/autonomous-agent/agent.py workflow "任务"` | 一键执行全流程 |
| **场景选择** | `python ./.trae/skills/autonomous-agent/agent.py scenario "任务"` | 获取场景信息 |
| **质量检查** | `python ./.trae/skills/autonomous-agent/agent.py quality --session ID` | 执行代码质检 |
| **交付文档** | `python ./.trae/skills/autonomous-agent/agent.py delivery --session ID` | 生成交付文档 |

---

## 三、核心原理

### 3.1 五场景决策树

📌 **系统会根据任务复杂度自动选择最优执行场景：**

```
Q1: 任务复杂度？
├── 简单(1-2步) → 场景1：提示增强
├── 中等(3-5步) → Q2: 有现成Skill可复用？
│   ├── 是 → 场景2：Skill复用
│   └── 否 → 场景3：计划+评审
└── 复杂(6+步) → Q3: 需要明确团队分工？
    ├── 是 → 场景4：Lead-Member
    └── 否 → 场景5：复合编排
```

#### 场景详解

| 场景 | 复杂度 | 策略 | 需确认 | 示例 |
|:---:|:---:|:---|:---:|:---|
| **提示增强** | 1-2 | 单步直接执行 | 否 | "帮我改个函数名" |
| **Skill复用** | 3-5 | 调用现有Skill | 否 | "帮我写篇公众号" |
| **计划+评审** | 3-5 | 规划→执行→Review | 否 | "重构认证模块" |
| **Lead-Member** | 6-10 | Leader分配→Member并行 | 是 | "做一个完整的用户系统" |
| **复合编排** | 6-10 | 多组Agent协作 | 是 | "从0搭建一个SaaS产品" |

### 3.2 三维度质量把关

📌 **每个任务完成后，系统会自动进行质量检查：**

| 维度 | 检查项 | 通过标准 |
|:---|:---|:---|
| **边界处理** | 空值处理、异常捕获、输入验证、边界条件 | ≥70% |
| **专业度** | 命名规范、错误提示、代码注释、日志记录 | ≥70% |
| **完整性** | 文档齐全、配置完整、示例代码、测试覆盖 | ≥70% |

💡 **质量检查流程**：
1. 执行任务
2. 运行质量检查
3. 如果未通过，自动反思修复
4. 重新检查，最多重试2次
5. 生成质量报告

### 3.3 六步执行协议

📌 **每个任务都会经过以下六个检查点：**

```
[检查点1] 初始化 → 确保系统就绪
[检查点2] 任务解析 → 理解用户意图
[检查点3] 场景决策 → 选择最优策略
[检查点4] 执行编排 → 开始执行任务
[检查点5] 质量验证 → 检查结果质量
[检查点6] 交付记忆 → 归档成功经验
```

⚠️ **重要**：缺少任何检查点 = 执行失败

### 3.4 反思进化机制

📌 **系统具备自我修复能力：**

```
执行任务 → 遇到错误 → 触发反思 → 查询历史记忆 → 
生成修复策略 → 重新执行 → 记录成功模式
```

**记忆写入时机**：
- **TASK_START**: 任务开始时
- **ERROR_OCCURRED**: 错误发生时
- **ERROR_FIXED**: 错误修复后
- **TASK_COMPLETE**: 任务完成时

---

## 四、系统架构

### 4.1 项目结构

```
.trae/
├── 🎯 核心引擎
│   └── autonomous-agent/        # 自主执行总调度器 v9.1
│       └── agent.py             # 【入口文件】一切从这里开始
│       └── core/
│           ├── token_tracker.py # Token计数模块 v2.0
│           ├── swarm.py         # 蜂群编排器 v2.5
│           ├── reflexion.py     # 反思模块 v2.3
│           ├── intelligence.py  # 智能分析引擎
│           ├── scenario_selector.py # 场景选择器
│           ├── quality_gate.py  # 质量门禁
│           ├── skill_discovery.py # 技能发现器
│           ├── delivery_doc.py  # 交付文档生成器
│           └── memory.py        # 记忆管理器
│
├── 🔧 技能系统 (.trae/skills/)
│   ├── feishu-doc-master/       # 飞书文档大师 v2.1
│   ├── neuro-bridge/            # 本地系统控制桥接器
│   ├── skill-manager/           # 技能管理器
│   └── workflow-market/         # 工作流市场
│
├── 📋 工作流系统
│   ├── workflow_manager_v2.py   # 自验证闭环工作流管理器
│   └── *.yaml                   # 预定义工作流模板
│
├── 🧠 记忆系统
│   ├── memory/                  # 会话记忆存储
│   └── knowledge/               # 知识库沉淀
│
└── 🐝 蜂群系统
    └── swarm/                   # 多智能体编排数据库
```

### 4.2 核心模块说明

| 模块 | 文件 | 职责 |
|:---|:---|:---|
| **统一内核** | `agent.py` | 入口文件，协调所有模块 |
| **场景选择器** | `scenario_selector.py` | 五场景决策树实现 |
| **质量门禁** | `quality_gate.py` | 三维度质量检查 |
| **蜂群编排器** | `swarm.py` | 多智能体并行执行 |
| **反思模块** | `reflexion.py` | 错误修复与学习 |
| **技能发现器** | `skill_discovery.py` | 自动发现匹配技能 |
| **记忆管理器** | `memory.py` | 会话记忆与知识沉淀 |

---

## 五、最佳实践

### 5.1 触发词使用建议

| 场景 | 推荐触发词 | 说明 |
|:---|:---|:---|
| 开始新任务 | **开始** | 最简洁的启动方式 |
| 继续上次任务 | **继续** | 自动恢复上下文 |
| 复杂项目 | **蜂群** | 启动多智能体并行 |

### 5.2 任务描述技巧

💡 **好的任务描述应该包含**：
- 明确的目标
- 具体的范围
- 期望的输出格式

**示例**：
```
❌ 差的描述：帮我写个东西
✅ 好的描述：开始 写一篇关于Python异步编程的技术博客，
           包含代码示例，字数2000字左右
```

### 5.3 常见问题

| 问题 | 原因 | 解决方案 |
|:---|:---|:---|
| 任务中途停止 | 未使用触发词 | 使用"开始"或"继续" |
| 质量检查未通过 | 代码质量不足 | 系统会自动修复，无需干预 |
| 找不到合适的Skill | Skill未安装 | 系统会推荐可安装的社区Skill |

---

## 六、总结

📌 **核心记忆点**：

| 要点 | 内容 |
|:---|:---|
| **一句话定义** | 触发词 → 自主执行 → 闭环交付 |
| **五场景** | 提示增强、Skill复用、计划+评审、Lead-Member、复合编排 |
| **三维度** | 边界处理、专业度、完整性 |
| **六检查点** | 初始化→解析→决策→执行→验证→交付 |
| **核心价值** | 一句话触发，全程自动，错误自修复，经验自沉淀 |

---

## 📦 快速安装

```bash
# 克隆仓库
git clone https://github.com/CyangZhou/trae-autonomous-workflow.git

# 复制到你的项目
cp -r trae-autonomous-workflow/.trae your-project/
```

---

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

---

*文档版本：v1.0 | 最后更新：2026-02-15*